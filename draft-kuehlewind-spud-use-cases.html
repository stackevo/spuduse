<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Use Cases for a Substrate Protocol for User Datagrams (SPUD)</title>

<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Principles and Assumptions"/>
<link href="#rfc.section.1.1.1" rel="Chapter" title="1.1.1 Trust and Integrity"/>
<link href="#rfc.section.1.1.2" rel="Chapter" title="1.1.2 Endpoint Control"/>
<link href="#rfc.section.1.1.3" rel="Chapter" title="1.1.3 Least Exposure"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Firewall Traversal for UDP-Encapsulated Traffic"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Problem Statement"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Information Exposed"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Mechanism"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Deployment Incentives"/>
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.3" rel="Chapter" title="3 On-Path State Lifetime Discovery and Management"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Problem Statement"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Information Exposed"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Mechanism"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Deployment Incentives"/>
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Path MTU Discovery"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Problem Statement"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Information Exposed"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Mechanism"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Deployment Incentives"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Low-Latency Service"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Problem Statement"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Information Exposed"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Mechanism"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Deployment Incentives"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Reordering Sensitivity"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Problem Statement"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Information Exposed"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Mechanism"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Deployment Incentives"/>
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Application-Limited Flows"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Problem Statement"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Information Exposed"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Mechanism"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Deployment Incentives"/>
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Priority Multiplexing"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Problem Statement"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Information Exposed"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Mechanism"/>
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Deployment Incentives"/>
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.9" rel="Chapter" title="9 In-Band Measurement"/>
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Problem Statement"/>
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Information Exposed"/>
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Mechanism"/>
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 Deployment Incentives"/>
<link href="#rfc.section.9.5" rel="Chapter" title="9.5 Security, Privacy, and Trust"/>
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations"/>
<link href="#rfc.section.12" rel="Chapter" title="12 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="13 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Kuehlewind, M., Ed. and B. Trammell, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-kuehlewind-spud-use-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-3-18" />
  <meta name="dct.abstract" content="This document identifies use cases for explicit cooperation between endpoints and middleboxes in the Internet under endpoint control. These use cases range from relatively low level applications (improving the ability for UDP-based protocols to traverse firewalls) through support for new transport services (in-flow prioritization for graceful in-network degradation of media streams). They are intended to provide background for deriving the requirements for a Substrate Protocol for User Datagrams (SPUD), as discussed at the IAB Stack Evolution in a Middlebox Internet (SEMI) workshop in January 2015 and the SPUD BoF session at IETF 92 in March 2015." />
  <meta name="description" content="This document identifies use cases for explicit cooperation between endpoints and middleboxes in the Internet under endpoint control. These use cases range from relatively low level applications (improving the ability for UDP-based protocols to traverse firewalls) through support for new transport services (in-flow prioritization for graceful in-network degradation of media streams). They are intended to provide background for deriving the requirements for a Substrate Protocol for User Datagrams (SPUD), as discussed at the IAB Stack Evolution in a Middlebox Internet (SEMI) workshop in January 2015 and the SPUD BoF session at IETF 92 in March 2015." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">M. Kuehlewind, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">B. Trammell, Ed.</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">ETH Zurich</td>
</tr>
<tr>
  <td class="left">Expires: September 19, 2016</td>
  <td class="right">March 18, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Use Cases for a Substrate Protocol for User Datagrams (SPUD)<br />
  <span class="filename">draft-kuehlewind-spud-use-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document identifies use cases for explicit cooperation between endpoints and middleboxes in the Internet under endpoint control. These use cases range from relatively low level applications (improving the ability for UDP-based protocols to traverse firewalls) through support for new transport services (in-flow prioritization for graceful in-network degradation of media streams). They are intended to provide background for deriving the requirements for a Substrate Protocol for User Datagrams (SPUD), as discussed at the IAB Stack Evolution in a Middlebox Internet (SEMI) workshop in January 2015 and the SPUD BoF session at IETF 92 in March 2015.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 19, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Principles and Assumptions</a></li>
<ul><li>1.1.1.   <a href="#rfc.section.1.1.1">Trust and Integrity</a></li>
<li>1.1.2.   <a href="#rfc.section.1.1.2">Endpoint Control</a></li>
<li>1.1.3.   <a href="#rfc.section.1.1.3">Least Exposure</a></li>
</ul></ul><li>2.   <a href="#rfc.section.2">Firewall Traversal for UDP-Encapsulated Traffic</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Problem Statement</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Information Exposed</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Mechanism</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Deployment Incentives</a></li>
<li>2.5.   <a href="#rfc.section.2.5">Security, Privacy, and Trust</a></li>
</ul><li>3.   <a href="#rfc.section.3">On-Path State Lifetime Discovery and Management</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Problem Statement</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Information Exposed</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Mechanism</a></li>
<li>3.4.   <a href="#rfc.section.3.4">Deployment Incentives</a></li>
<li>3.5.   <a href="#rfc.section.3.5">Security, Privacy, and Trust</a></li>
</ul><li>4.   <a href="#rfc.section.4">Path MTU Discovery</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Problem Statement</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Information Exposed</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Mechanism</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Deployment Incentives</a></li>
<li>4.5.   <a href="#rfc.section.4.5">Security, Privacy, and Trust</a></li>
</ul><li>5.   <a href="#rfc.section.5">Low-Latency Service</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Problem Statement</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Information Exposed</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Mechanism</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Deployment Incentives</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Security, Privacy, and Trust</a></li>
</ul><li>6.   <a href="#rfc.section.6">Reordering Sensitivity</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Problem Statement</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Information Exposed</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Mechanism</a></li>
<li>6.4.   <a href="#rfc.section.6.4">Deployment Incentives</a></li>
<li>6.5.   <a href="#rfc.section.6.5">Security, Privacy, and Trust</a></li>
</ul><li>7.   <a href="#rfc.section.7">Application-Limited Flows</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Problem Statement</a></li>
<li>7.2.   <a href="#rfc.section.7.2">Information Exposed</a></li>
<li>7.3.   <a href="#rfc.section.7.3">Mechanism</a></li>
<li>7.4.   <a href="#rfc.section.7.4">Deployment Incentives</a></li>
<li>7.5.   <a href="#rfc.section.7.5">Security, Privacy, and Trust</a></li>
</ul><li>8.   <a href="#rfc.section.8">Priority Multiplexing</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Problem Statement</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Information Exposed</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Mechanism</a></li>
<li>8.4.   <a href="#rfc.section.8.4">Deployment Incentives</a></li>
<li>8.5.   <a href="#rfc.section.8.5">Security, Privacy, and Trust</a></li>
</ul><li>9.   <a href="#rfc.section.9">In-Band Measurement</a></li>
<ul><li>9.1.   <a href="#rfc.section.9.1">Problem Statement</a></li>
<li>9.2.   <a href="#rfc.section.9.2">Information Exposed</a></li>
<li>9.3.   <a href="#rfc.section.9.3">Mechanism</a></li>
<li>9.4.   <a href="#rfc.section.9.4">Deployment Incentives</a></li>
<li>9.5.   <a href="#rfc.section.9.5">Security, Privacy, and Trust</a></li>
</ul><li>10.   <a href="#rfc.section.10">IANA Considerations</a></li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a></li>
<li>12.   <a href="#rfc.section.12">Acknowledgments</a></li>
<li>13.   <a href="#rfc.references">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">This document describe use cases for a common Substrate Protocol for User Datagrams (SPUD) that could be used by superstrate transport or application protocols to explicitly expose information to and exchange information with middleboxes about application traffic and network conditions.</p>
<p id="rfc.section.1.p.2">For each use case, we first describe a problem that is difficult or impossible to solve with presently deployable protocols within the present Internet architecture. We then discuss which information is exposed by endpoints about the traffic sent, and/or by SPUD-aware middleboxes and routers about the path that traffic will traverse.  We also suggest potential mechanisms to use that exposed information at middleboxes and/or endpoints, in order to demonstrate the feasibility of using the exposed information to the given use case.The described mechanisms are not necessarily proposals for moving forward, nor do they necessarily represent the best approach for applying the exposed information, but should illustrate and motivate the applicability of the exposed information. We further discuss incentives for deployment and any security, privacy, and trust issues that arise in exposing and/or making use of the information.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#principles-and-assumptions" id="principles-and-assumptions">Principles and Assumptions</a></h1>
<p id="rfc.section.1.1.p.1">We make a few assumptions about first principles in elaborating these use cases</p>
<h1 id="rfc.section.1.1.1"><a href="#rfc.section.1.1.1">1.1.1.</a> <a href="#trust-and-integrity" id="trust-and-integrity">Trust and Integrity</a></h1>
<p id="rfc.section.1.1.1.p.1">In this document, we assume no pre-existing trust relationship between the communication endpoints and any middlebox or router on the path.  We must therefore always assume that information that is exposed can be incorrect, and/or that the information will be ignored.</p>
<p id="rfc.section.1.1.1.p.2">This implies that while endpoints can verify the integrity of information exposed by remote endpoints, they cannot verify the integrity of information exposed by middleboxes. Middleboxes cannot verify the integrity of any information at all. In limited situations where a trust relationship can be established, e.g., between a managed end-user device in an enterprise network and a corporate firewall, this verifiability can be improved.</p>
<h1 id="rfc.section.1.1.2"><a href="#rfc.section.1.1.2">1.1.2.</a> <a href="#endpoint-control" id="endpoint-control">Endpoint Control</a></h1>
<p id="rfc.section.1.1.2.p.1">We further assume that all information exposure by middleboxes happens under explicit endpoint control. For that reason, the information exposed by middleboxes in this document takes only two forms. In the first form, &#8220;accumulation&#8221;, the endpoint creates space in the header for middleboxes to use to signal to the remote endpoint, which then sends the information back to the originating endpoint via a feedback channel. In the second form, the middlebox sends a packed directly back to the endpoint with additional information about why a packet was dropped. Other communications patterns may be possible, depending on the first principles chosen; this is a subject of future work.</p>
<h1 id="rfc.section.1.1.3"><a href="#rfc.section.1.1.3">1.1.3.</a> <a href="#least-exposure" id="least-exposure">Least Exposure</a></h1>
<p id="rfc.section.1.1.3.p.1">Additionally, this document follows the principle of least exposure: in each use case, we attempt to define the minimum amount of information exposed by endpoints and middleboxes required by the proposed mechanism to solve the identified problem. In addition to being good engineering practice, this approach reduces the risk to privacy through inadvertent irrelevant metadata exposure, reduces the amount of information available for application fingerprinting, and reduces the risk that exposed information could otherwise be used for unintended purposes.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#firewall-traversal-for-udp-encapsulated-traffic" id="firewall-traversal-for-udp-encapsulated-traffic">Firewall Traversal for UDP-Encapsulated Traffic</a></h1>
<p id="rfc.section.2.p.1">We presume, following an analysis of requirements in <a href="#I-D.trammell-spud-req">[I-D.trammell-spud-req]</a>, as well as trends in transport protocol development (e.g. QUIC, the RTCWEB data channel) that UDP encapsulation will prove a viable approach for deploying new protocols in the Internet. This, however, leads us to a first problem that must be solved.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#problem-statement" id="problem-statement">Problem Statement</a></h1>
<p id="rfc.section.2.1.p.1">UDP is often blocked by firewalls, or only enabled for a few well-known applications (e.g. DNS, NTP). Recent measurement work has shown that somewhere between 4% and 8% of Internet hosts may be affected by UDP impairment, depending on the population studied. Some networks (e.g. enterprise networks behind corporate firewalls) are far more likely to block UDP than others (e.g.  residential wireline access networks).</p>
<p id="rfc.section.2.1.p.2">In addition, some network operators assume that UDP is not often used for high-volume traffic, and is often a source of spoofing or reflected attack traffic, and is therefore safe to block or route-limit. This assumption is becoming less true than it once was: the volume of (good) UDP traffic is growing, mostly due to voice and video (real-time) services (e.g. RTCWEB) where TCP is not suitable.</p>
<p id="rfc.section.2.1.p.3">Even if firewall vendors and administrators are willing to change firewall rules to allow more diverse UDP services, it is hard to track session state for UDP traffic. As UDP is unidirectional, it is unknown whether the receiver is willing to accept the connection. Further there is no way to figure how long state must be maintained once established. To efficiently establish state along the path we need an explicit contract, as is done implicitly with TCP today.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#information-exposed" id="information-exposed">Information Exposed</a></h1>
<p id="rfc.section.2.2.p.1">To maintain state in the network, it must be possible to easily assign each packet to a session that is passing a certain network node. This state should be bound to something beyond the five-tuple to link packets together.  In <a href="#I-D.trammell-spud-req">[I-D.trammell-spud-req]</a>, we propose the use of identifiers for groups of packets, called (&#8220;tubes&#8221;). This allows for differential treatment of different packets within one five-tuple flow, presuming the application has control over segmentation and can provide requirements on a per-tube basis. Tube IDs must be hard to guess: a tube ID in addition to a five-tuple as an identifier, given significant entropy in the tube ID, provides an additional assurance that only devices along the path or devices cooperating with devices along the path can send packets that will be recognized by middleboxes and endpoints as valid.</p>
<p id="rfc.section.2.2.p.2">Further, to maintain state, the sender must explicitly indicate the start and end of a tube to the path, while the receiver must confirm connection establishment. This, together with the first packet following the confirmation, provides a guarantee of return routability; i.e. that the sender is actually at the address it says it is. This implies all SPUD tubes must be bidirectional, or at least support a feedback channel for this confirmation.  Even though UDP is not a bidirectional transport protocol, often services on top of UDP are bidirectional anyway. Even if not, we only require one packet to acknowledge a new connection. This is low overhead for this basic security feature. This connection set-up should not impose any additional start-up latency, so the sender must be also able to send payload data in the first packet.</p>
<p id="rfc.section.2.2.p.3">If a firewall blocks a SPUD packet, it can be beneficial for the sender to know why the packet was blocked. Therefore a SPUD-aware middlebox should be able to send error messages. Such an error message can either be sent directly to the sender itself, or alternatively to the receiver that can decide to forward the error message to a sender or not.</p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#mechanism" id="mechanism">Mechanism</a></h1>
<p id="rfc.section.2.3.p.1">A firewall or middlebox can use the tube ID as an identifier for its session state information. If the tube ID is large enough it will be hard for a non- eavesdropping attacker to guess the ID.</p>
<p id="rfc.section.2.3.p.2">If a firewall receives a SPUD message that signals the start of a connection, it can decide to establish new state for this tube. Alternatively, it can also forward the packet to the receiver and wait if the connection is wanted before establishing state. To not require forwarding of unknown payload, a firewall might want to forward the initial SPUD packet without payload and only send the full packet if the connection has be accepted by the receiver.</p>
<p id="rfc.section.2.3.p.3">The firewall must still maintain a timer to delete the state of a tube if no packets were received for a while. However, if a end signal is received the firewall can remove the state information faster.</p>
<p id="rfc.section.2.3.p.4">If a firewall receives a SPUD message which does not indicate the start of a new tube and no state is available for this tube, it may decide to block the traffic. This can happen if the state has already timed out or if the traffic was rerouted. In addition a firewall may send an error message to the sender or the receiver indicating that no state information is available. If the sender receives such a message it can resend a start signal (potentially together with other tube state information) and continue its transmission.</p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#deployment-incentives" id="deployment-incentives">Deployment Incentives</a></h1>
<p id="rfc.section.2.4.p.1">The ability to use existing firewall management best practices with new transport services over SPUD is necessary to ensure the deployability of SPUD.  In today&#8217;s Internet, application developers really only have two choices for transport protocols: TCP, or transports implemented at the application layer and encapsulated over UDP. SPUD provides a common shim layer for the second case, and the firewall traversal facility it provides makes these transports more likely to deploy.</p>
<p id="rfc.section.2.4.p.2">It is not expected that the information provided by SPUD will enable all generic UDP-encapsulated transports to safely pass firewalls. However, it does make state handling easier for new services that a firewall administrator is willing to allow.</p>
<h1 id="rfc.section.2.5"><a href="#rfc.section.2.5">2.5.</a> <a href="#security-privacy-and-trust" id="security-privacy-and-trust">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.2.5.p.1">The tube ID is scoped to the five-tuple. While this makes the tube ID useless for session mobility, it does mean that the valid ID space is sufficiently sparse to maintain the &#8220;hard to guess&#8221; property, and prevents tube IDs from being misused to track flows from the same endpoint across multiple addresses. This limitation may need further discussion.</p>
<p id="rfc.section.2.5.p.2">By providing information about connection setup, SPUD exposes information equivalent to that available in the TCP header. It makes connection lifetime information explicit and accessible without specific higher-layer/application- level knowledge.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#on-path-state-lifetime-discovery-and-management" id="on-path-state-lifetime-discovery-and-management">On-Path State Lifetime Discovery and Management</a></h1>
<p id="rfc.section.3.p.1">Once the problem of connection setup is solved, the problem arises of managing the lifetime of state associated with that connection at various devices along the path: NAT and stateful firewall state timeouts are a common cause of connectivity issues in the Internet.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#problem-statement-1" id="problem-statement-1">Problem Statement</a></h1>
<p id="rfc.section.3.1.p.1">Devices along the path that must keep state in order to function cannot assume that signals tearing down a connection are provided reliably. This is also the case for current TCP traffic. Therefore, all stateful on-path devices must implement a mechanism to remove the state if no traffic is seen for a given flow or tube for a while. Usually this is implemented by maintaining a timeout since the last observed packet.</p>
<p id="rfc.section.3.1.p.2">If the timeouts are set too low, on-path state might be discarded while the endpoint connection is still alive; in the case of firewalls and NATs, this can lead to unreliable connectivity. The common solution to this problem is for applications or transport protocols that do not have any productive traffic to send to send &#8220;heartbeat&#8221; or &#8220;keep-alive&#8221; packets to reset the state timeout along the path. However, since the minimum timeout along the path is unknown to the endpoint, implementers of transport and application . A default value of 150ms is commonly used today. This represents a fairly rapid generation of nonproductive traffic, and is especially onerous on battery- powered mobile devices, which must wake up radios and switch to a higher-power mode to transmit these nonproductive packets, leading to suboptimal power usage and shorter battery life.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#information-exposed-1" id="information-exposed-1">Information Exposed</a></h1>
<p id="rfc.section.3.2.p.1">SPUD can be used to request that SPUD-aware middleboxes along the path expose their minimum state timeout value. Here, the sending endpoint sends a &#8220;accumulate minimum timeout&#8221; request along with some scratch space for middleboxes to place their timeout information in. Each middlebox inspects this value, and writes its own timeout only if lower than the present value.</p>
<p id="rfc.section.3.2.p.2">Applications may also send a &#8220;timeout proposal&#8221; to devices along the path using a SPUD declaration that a given tube will send a packet at least once per interval, and if no packet is seen within that interval, it is safe to tear down state.</p>
<p id="rfc.section.3.2.p.3">These two declarations may be used together, with middleboxes willing to use the application&#8217;s value setting their timeouts on a per-tube basis, or exposing a lower timeout value to allow the application to adjust.</p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#mechanism-1" id="mechanism-1">Mechanism</a></h1>
<p id="rfc.section.3.3.p.1">If a SPUD-aware middlebox that uses a timeout to clean up per-tube state receives a SPUD minimum timeout accumulation, it should expose its own timeout value if smaller than the one already given. Alternatively, if a value is already given, it might decide to use the given value as timeout for the state information of this tube. An endpoint receiving an accumulated minimum timeout should send it back to its remote peer via a feedback channel. Timeouts on each direction of a connection between two endpoints may, of course, be different, and are handled separately by this mechanism.</p>
<p id="rfc.section.3.3.p.2">If a SPUD-aware middlebox that uses a timeout to clean up per-tube state receives a timeout proposal, it should set its timeout accordingly, subject to its own policy and configuration.</p>
<p id="rfc.section.3.3.p.3">These mechanisms are of course completely advisory: there may be non-SPUD aware middleboxes on path which will ignore any proposed timeout and not expose their timeout information, and middleboxes must be configured with maximum timeout proposal they will accept in order to defend against state exhaustion attacks.</p>
<p id="rfc.section.3.3.p.4">Endpoints must therefore be combine the use of these signals endpoint with a dynamic timeout discovery and adaptation mechanism, which uses the signals to set initial guesses as to the path timeout.</p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> <a href="#deployment-incentives-1" id="deployment-incentives-1">Deployment Incentives</a></h1>
<p id="rfc.section.3.4.p.1">Initially, if not widely deployed, there will be not much benefit to using this extension.</p>
<p id="rfc.section.3.4.p.2">However, we can assume that there are usually only a small number of middleboxes on a given network path that hold per-tube state information.  Endpoints have an incentive to request minimum timeout and to propose timeouts to improve convergence time for dynamic timeout adaptation mechanisms, and middleboxes have an incentive to cooperate to improve reliability of connections as well as state management. It is therefore likely that if information is exposed by a middlebox, this information is correct and can be used.</p>
<p id="rfc.section.3.4.p.3">The more SPUD gets deployed, the more often endpoints will be able to set the heartbeat interval correctly. This will reduce the amount of unproductive traffic as well as the number of reconnections that cause additional latency.</p>
<p id="rfc.section.3.4.p.4">Likewise, SPUD-aware middleboxes that expose  timeout information are able to handle timeouts more flexibly, e.g. announcing lower timeout values when they have less space available for new state. Further if an endpoint announces a low pre-set value because the endpoint knows that it will only have short idle periods, the timeout interval could be reduced.</p>
<h1 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5.</a> <a href="#security-privacy-and-trust-1" id="security-privacy-and-trust-1">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.3.5.p.1">Timeout proposals increase the risk of state exhaustion attacks for SPUD-aware middleboxes that naively follow them. Likewise, accumulated minimum timeouts could be used by malicious middleboxes to induce floods of useless heartbeat traffic along the path, and/or exhaust resources on endpoints that naively follow them. All timeout proposals and minimum timeouts must therefore be inputs to a dynamic timeout selection process, both at endpoints and on-path devices, which use these signals as hints but clamp their timeouts to sane values set by local policy.</p>
<p id="rfc.section.3.5.p.2">While device timeout and heartbeat interval are generally not linked to privacy-sensitive information, a timeout proposal may add a number of bits of entropy to an endpoint&#8217;s unique fingerprint. It is therefore advisable to suggest a small number of useful timeout proposals, in order to reduce this value&#8217;s contribution to an endpoint fingerprint.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#path-mtu-discovery" id="path-mtu-discovery">Path MTU Discovery</a></h1>
<p id="rfc.section.4.p.1">Similar to the state timeout problem is the Path MTU problem: differing MTUs on different devices along the path can lead to fragmentation or connectivity issues. This problem is made worse by the increasing proliferation of tunnels in the Internet, which reduce the MTU by the amount required for tunnel headers.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#problem-statement-2" id="problem-statement-2">Problem Statement</a></h1>
<p id="rfc.section.4.1.p.1">In order to efficiently send packets along a path end to end, they must be sized to fit in the MTU of the &#8220;narrowest&#8221; link along the path. Algorithms for path MTU discovery have been defined and standardized for a quarter century, in <a href="#RFC1191">[RFC1191]</a> for IPv4 and <a href="#RFC1981">[RFC1981]</a> for IPv6, but they are not often implemented due in part to widespread impairment of ICMP. Packetization Layer Path MTU Discovery <a href="#RFC4821">[RFC4821]</a> (PLPMTUD) is a more recent attempt to solve the problem, which has the advantage of being transport-protocol independent and functional without ICMP feedback. SPUD, as a shim between UDP and superstrate transport protocols, is at the right place in the stack to implement PLPMTUD, and explicit cooperation can enhance its operation.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#information-exposed-2" id="information-exposed-2">Information Exposed</a></h1>
<p id="rfc.section.4.2.p.1">SPUD can be used to request that SPUD-aware middleboxes along the path expose their next-hop path MTU value. Here, the sending endpoint sends a &#8220;accumulate minimum MTU&#8221; request along with some scratch space for middleboxes to place the next-hop MTU for the given tube. Each middlebox inspects this value, and writes its own next-hop MTU only if lower than the present value.</p>
<p id="rfc.section.4.2.p.2">A SPUD-aware middlebox that receives a packet that is too big for the next-hop MTU can send back a signal associated with the tube directly to the sender, including the next-hop MTU.</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#mechanism-2" id="mechanism-2">Mechanism</a></h1>
<p id="rfc.section.4.3.p.1">PLPMTUD functions by dynamically increasing the size of packets sent, and reacting to the loss of the first &#8220;too large&#8221; packet as an MTU reduction signal, instead of a congestion signal. This must be implemented in cooperation with the superstrate transport protocol, as it is responsible for how non-MTU-related loss is treated.</p>
<p id="rfc.section.4.3.p.2">When an endpoint receives an accumulated minimum MTU, it should should send it back to its remote peer via a feedback channel. The minimum of this value and any direct next-hop MTU signals received from SPUD-aware middleboxes can be used as a hint to the sender&#8217;s PLPMTUD process, as a likely upper bound for path MTU associated with a tube.</p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#deployment-incentives-2" id="deployment-incentives-2">Deployment Incentives</a></h1>
<p id="rfc.section.4.4.p.1">As with state lifetime discovery, these signals are of little initial utility to endpoints before SPUD-aware middleboxes are deployed. However, SPUD-aware middleboxes that sit at potential MTU breakpoints along a path, either those which terminate tunnels or bridge networks with two different link types, have an incentive to improve reliability by responding to accumulation requests and sending next-hop MTU messages to SPUD-aware endpoints.</p>
<h1 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> <a href="#security-privacy-and-trust-2" id="security-privacy-and-trust-2">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.4.5.p.1">As with state lifetime discovery, Minimum MTU and next-hop MTU signals could be used by malicious middleboxes to set the endpoint&#8217;s maximum packet size to inefficiently small sizes, if the endpoint follows them naively. For that reason, endpoints should use this information only as hints to improve the operation of PLPMTUD, and may probe above the value derived from the SPUD- supplied information when deemed appropriate by endpoint policy or transport protocol requirements.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#low-latency-service" id="low-latency-service">Low-Latency Service</a></h1>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#problem-statement-3" id="problem-statement-3">Problem Statement</a></h1>
<p id="rfc.section.5.1.p.1">Networks are often optimized for low loss rates and high throughput by providing large buffers that can absorb traffic spikes and rate variations while  holding enough data to keep the link full. This is beneficial for applications like high-priority bulk transfer, where only the total transfer time is of interest. High-volume interactive applications, such as videoconferencing, however, have very different requirements. Usually these applications can tolerate higher loss rates, while having hard latency requirements.</p>
<p id="rfc.section.5.1.p.2">Large network buffers may induce high queuing delays due to cross traffic using loss-based congestion control, which must periodically fill the buffer to induce loss during probing for additional bandwidth. This queueing delay can negatively impact the quality of experience for competing interactive applications, even making them unusable.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#information-exposed-3" id="information-exposed-3">Information Exposed</a></h1>
<p id="rfc.section.5.2.p.1">The simplest mechanism for solving this problem is to separate loss-sensitive from latency-sensitive traffic, as proposed using DSCP codepoints in <a href="#I-D.you-tsvwg-latency-loss-tradeoff">[I-D.you-tsvwg-latency-loss-tradeoff]</a>. This signal could also be emitted as a per-packet signal within SPUD, since DSCP codepoints are often used for internal traffic engineering and therefore cleared at network borders. This indication does not prioritize one kind of traffic over the other: while loss- sensitive traffic might face larger buffer delay but lower loss rate, latency- sensitive traffic has to make exactly the opposite tradeoff.</p>
<p id="rfc.section.5.2.p.2">An endpoint can also indicate a maximum acceptable single-hop queueing delay per tube, expressed in milliseconds. While this mechanism does not guarantee that sent packets will experience less than the requested delay due to queueing delay, it can significantly reduce the amount of traffic uselessly sitting in queues, since at any given instance only a small number of queues along a path (usually only zero or one) will be full.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#mechanism-3" id="mechanism-3">Mechanism</a></h1>
<p id="rfc.section.5.3.p.1">A middlebox may use the loss-/latency tradeoff signal to assign packet to the appropriate type of service, if different services are implemented at this middlebox. Traffic not indicating a low loss or low latency preference would still be assigned to today&#8217;s best-effort service, while a new low latency service would be introduced in addition.</p>
<p id="rfc.section.5.3.p.2">The simplest implementation of such a low latency service (without disturbing existing traffic) is to manage traffic with the latency-sensitive flag set in a separate queue. This queue either, in itself, provides only a short buffer which induces a hard limit for the maximum (per-queue) delay or uses an AQM (such as PIE/CoDel) that is configured to keep the queuing delay low.</p>
<p id="rfc.section.5.3.p.3">In such a two-queue system the network provider must decide about bandwidth sharing between both services, and might or might not expose this information.  Initially there will only be a few flows that indicate low latency preference.  Therefore at the beginning this service might have a low maximum bandwidth share assigned in the scheduler. However, the sharing ratio should be adapted to the traffic load/number of flows in each service class over long timescales.</p>
<p id="rfc.section.5.3.p.4">Applications and endpoints setting the latency sensitivity flag on a tube must be prepared to experience relatively higher loss rates on that tube, and should use techniques such as Forward Error Correction (FEC) to cope with these losses.</p>
<p id="rfc.section.5.3.p.5">If a maximum per-hop delay is indicated by the sender, a SPUD- aware router might drop any packet which would be placed in a queue that has more than the maximum single-hop delay at that point in time before queue admission. Thereby the overall congestion can be reduced early instead of withdrawing the packet at the receiver after it has blocked network resources for other traffic.</p>
<p id="rfc.section.5.3.p.6">A transport protocol at an endpoint indicating the maximum per-hop delay must be aware that is might face higher loss rates under congestion than competing traffic on the same bottleneck.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#deployment-incentives-3" id="deployment-incentives-3">Deployment Incentives</a></h1>
<p id="rfc.section.5.4.p.1">Application developers go to a great deal of effort to make latency-sensitive traffic work over today&#8217;s Internet. However, if large delays are induced by the network, an application at the endpoint cannot do much. Therefore applications can benefit from further support by the network.</p>
<p id="rfc.section.5.4.p.2">Network operators have already realized a need to better support low latency services. However, they want to avoid any service degradation for existing traffic as well as risking stability due to large configuration changes.  Introducing an additional service for latency-sensitive traffic that can exist in parallel to today&#8217;s network service helps this problem.</p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#security-privacy-and-trust-3" id="security-privacy-and-trust-3">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.5.5.p.1">An application cannot benefit from wrongly indicating loss- or latency- sensitivity, as it has to make a tradeoff between low loss and potential high delay or low delay and potential high loss.</p>
<p id="rfc.section.5.5.p.2">A simple classification of traffic as loss- or latency-sensitive does not expose privacy-critical information about the user&#8217;s behavior; indeed, it exposes far less than presently used by DPI-based traffic classifiers that would be used to determine the latency sensitivity of traffic passing a middlebox.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#reorder" id="reorder">Reordering Sensitivity</a></h1>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#problem-statement-4" id="problem-statement-4">Problem Statement</a></h1>
<p id="rfc.section.6.1.p.1">TCP&#8217;s fast retransmit mechanism interprets the reception of three duplicated acknowledgement (where the acknowledgement number is the same than in the previous acknowledgement) as a signal for loss detection. However, a missing packet in the sequence number space must not always be lost. Simple reordering where one packet takes a longer path than (at least three) subsequent packets can have the same effect.</p>
<p id="rfc.section.6.1.p.2">In addition in TCP, loss is an implicit signal for network congestion.  Therefore the reception of three duplicated acknowledgement will cause a TCP sender to reduce its sending rate. To avoid unnecessary performance decreases, today&#8217;s in-network mechanisms usually aim to avoid reordering. However, this complicates these mechanism significantly and usually requires per-flow state, e.g. in case of Equal Cost Multipath (ECMP) routing where a hash of the 5 tuple would need to be mapped to the right path.</p>
<p id="rfc.section.6.1.p.3">Even though the majority of traffic in the Internet is still TCP, it is likely that new protocols will be design such that they are (more) robust to reordering. Further with an increasing deployment of ECN, even TCP&#8217;s congestion control reaction based on duplicated acknowledgements could be relaxed (e.g. by reducing the sending rate gradually depending on the number of lost packets).</p>
<p id="rfc.section.6.1.p.4">However, as middlebox can not know if a certain traffic flow is sensitive to reordering or not, they have to treat all traffic as equally and try to always avoid reordering. (This does not only complicate these mechanism but might also block the deployment of new services.)</p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#information-exposed-4" id="information-exposed-4">Information Exposed</a></h1>
<p id="rfc.section.6.2.p.1">Reordering-sensitivity is a per tube signal (as reordering can only happen with a flow multiple packets). However, to avoid state in middlebox, it would be beneficial to have a reordering-sensitive flag in each packet.</p>
<p id="rfc.section.6.2.p.2">A transport should set the bit if it is not sensitive to reordering, e.g. if it uses a more advance mechanism (than duplicated acknowledgement) for loss detection, or if the congestion control reaction to this signal imposes only a small performances penalty, or if the flow is short enough that it will not impact its performance.</p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> <a href="#mechanism-4" id="mechanism-4">Mechanism</a></h1>
<p id="rfc.section.6.3.p.1">A middlebox that implement an in-network function that could lead to varying end-to-end delay and reordering (as packets might overtake each other on different paths or within the network device), do not need to perform any additional action if the reordering-sensitivity flag is not set. However, if the flag is set, the middlebox should avoid reordering by e.g. holding per- tube state and make sure that all packets belonging to the same tube will not be re-ordered.</p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> <a href="#deployment-incentives-4" id="deployment-incentives-4">Deployment Incentives</a></h1>
<p id="rfc.section.6.4.p.1">Today by default middlebox assume that all traffic is reordering-sensitive which complicates certain in-network mechanism or might also block the deployment of new services. If a middlebox would know that certain traffic is not reordering-sensitive, it could reduce state, speed-up processing, or even implement new services.</p>
<p id="rfc.section.6.4.p.2">Applications that are not loss-sensitive (because they e.g. uses FEC) usually are also not reordering-sensitive. At the same time these application are often sensitive to latency. If the transport handles reordering appropriately and signal this semantic information to the network, the appropriate network treatment can likely also result in lower end-to-end or at least enables the network device to impose any additional delay (e.g. to set up state) on these packets.</p>
<h1 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a> <a href="#security-privacy-and-trust-4" id="security-privacy-and-trust-4">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.6.5.p.1">No trust relationship is needed as the provided information do not results in a preferential treatment. Only transport semantics are exposed that to not contain any private information.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#applimited" id="applimited">Application-Limited Flows</a></h1>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#problem-statement-5" id="problem-statement-5">Problem Statement</a></h1>
<p id="rfc.section.7.1.p.1">Many flows are application-limited, where the application itself adapts the limit to changing traffic conditions or link characteristics, such as with unicast adaptive bitrate streaming video. This adaptation is difficult, since TCP cross-traffic will often probe for available bandwidth more aggressively than the application&#8217;s control loop. Further complicating the situation is the fact that rate adaptation may have negative effects on the user&#8217;s quality of experience, and should therefore be done infrequently.</p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#information-exposed-5" id="information-exposed-5">Information Exposed</a></h1>
<p id="rfc.section.7.2.p.1">A SPUD endpoint sending application-limited traffic can provide an explicit per-tube indication of the maximum intended data rate needed by the current encoding or data source. If the bottleneck device is SPUD-aware, it can  use this information to decide how to correctly treat the tube, e.g. setting a rate limit or scheduling weight if served from its own queue.</p>
<p id="rfc.section.7.2.p.2">A SPUD endpoint could also send a &#8220;minimum rate limit accumulation&#8221; request, similar to the other accumulation requests outlined above, where SPUD-aware routers and middleboxes could note the maximum bandwidth available to a tube.  Receiving this signal on a feedback channel could allow a sender to more quickly adapt its sending rate. This rate limit information might be derived from local per-flow or per-tube rate limit policy, as well as from current information about load at the router.</p>
<p id="rfc.section.7.2.p.3">These signals can be sent throughout the lifetime of the flow, to help adapt to changing application demands and/or network conditions.</p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#mechanism-5" id="mechanism-5">Mechanism</a></h1>
<p id="rfc.section.7.3.p.1">Maximum expected data rate exposed by the endpoints could be used to make routing decisions and queue selection decisions at SPUD-aware routers, if different paths or queues with different capacity, delay, and load characteristics are available.</p>
<p id="rfc.section.7.3.p.2">A SPUD-aware router that indicates a rate limit can be used by the sender to choose an encoding. However, the sender should still implement a mechanism to probe for available bandwidth to verify the provided information. As a certain rate limit is expected, the sender should probe carefully around this rate.</p>
<p id="rfc.section.7.3.p.3">These mechanisms can also be used for rate increases. If a sender receives an indication that more bandwidth is available it should probe carefully, instead of switching to the higher rate immediately, and decrease its sensitivity to loss (e.g. through the use of additional FEC) which will provide additional protection as soon as the new capacity limit is reached. Likewise, a SPUD- aware router that receives an indication that a flow intends to increase its might prioritize this flow for a certain (short) time to enable a smoother transition.</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#applimited-incentive" id="applimited-incentive">Deployment Incentives</a></h1>
<p id="rfc.section.7.4.p.1">Endpoints that indicate maximum sending rate for application-limited traffic on SPUD-aware networks allow the operators of those networks to better handle traffic. This can benefit the service quality and increase the user&#8217;s satisfaction with the provided network service.</p>
<p id="rfc.section.7.4.p.2">Currently applications have no good indication when to change their coding rate. Rate increases are especially hard. Further, frequent rate changes should be avoided for quality of experience. Cooperative indication of intended and available sending rate for application-limited flows can simplify probing, and provide signals beyond loss to react effectively to congestion.</p>
<h1 id="rfc.section.7.5"><a href="#rfc.section.7.5">7.5.</a> <a href="#security-privacy-and-trust-5" id="security-privacy-and-trust-5">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.7.5.p.1">Both endpoints and SPUD-aware middleboxes should react defensively to rate limit and rate intention information. Endpoints and middleboxes should use measurement and probing to verify that rate information is accurate, but the exposed rate information can be used as hints to routing, scheduling, and rate determination processes.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#priority-multiplexing" id="priority-multiplexing">Priority Multiplexing</a></h1>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> <a href="#problem-statement-6" id="problem-statement-6">Problem Statement</a></h1>
<p id="rfc.section.8.1.p.1">Many services require multiple parallel transmissions to transfer different kinds of data which have clear priority relationships among them. For example, in WebRTC, audio frames should be prioritized over video frames. Sometimes these transmissions happen in different flows, and sometimes some packets within a flow have higher priority than others, for example I-frames in video transmissions. However, current networks will treat all packets the same in case of congestion and might e.g. drop audio packets while video and control traffic are still transmitted.</p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> <a href="#information-exposed-6" id="information-exposed-6">Information Exposed</a></h1>
<p id="rfc.section.8.2.p.1">A SPUD sender may indicate a that one tube should &#8220;yield&#8221; to another, i.e.  that it should have lower relative priority than another tube in the same flow. Similarly, individual packets within a tube could be marked as having lower priority. This information can be used to preferentially drop less important packets e.g. carrying information that could be recovered by FEC.</p>
<p id="rfc.section.8.2.p.2">With a stronger integration of codec and transport protocols, SPUD could even indicate more fine-grained priority levels to provide automatic graceful degradation of service within the network itself.</p>
<h1 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> <a href="#mechanism-6" id="mechanism-6">Mechanism</a></h1>
<p id="rfc.section.8.3.p.1">Designing a general-purpose mechanism that maps relative priorities from the yield information exposed via SPUD to correct per-tube and per-packet treatment at any point in the Internet, is an extremely hard problem and a possible subject for future research. It appears impossible at this writing to design a straightforward mapping function from these relative priorities per- flow to absolute priorities across flows in a fair way.</p>
<p id="rfc.section.8.3.p.2">However, in the not-uncommon case that exists in many access networks, where the bottleneck link has per-user queues and can enforce per-user fairness, the relative priorities can be mapped to absolute priorities, and simple priority queueing at the bottleneck can be used. Lower priority packets within a tube, however, should be assigned to the tube&#8217;s priority class, and preferentially dropped instead, e.g. using a different drop threshold at the queue.</p>
<h1 id="rfc.section.8.4"><a href="#rfc.section.8.4">8.4.</a> <a href="#deployment-incentives-5" id="deployment-incentives-5">Deployment Incentives</a></h1>
<p id="rfc.section.8.4.p.1">Deployment incentives for priority multiplexing are similar to those for bandwidth declaration for app-limited flows as in <a href="#applimited-incentive">Section 7.4</a>: endpoints that correctly declare priority information will experience better quality of service on SPUD-enabled networks, and SPUD-enabled networks get information that allows them to better manage traffic.</p>
<h1 id="rfc.section.8.5"><a href="#rfc.section.8.5">8.5.</a> <a href="#security-privacy-and-trust-6" id="security-privacy-and-trust-6">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.8.5.p.1">Since yield information can only be used to disadvantage an application&#8217;s traffic relative to its own traffic, there is no incentive for applications to declare incorrect yielding.</p>
<p id="rfc.section.8.5.p.2">The pattern and relative volume of traffic in different yield classes may be used to &#8220;fingerprint&#8221; certain applications, though it is not clear whether this provides additional information beyond that contained inter-packet delay and volume patterns.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#meas" id="meas">In-Band Measurement</a></h1>
<h1 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1.</a> <a href="#problem-statement-7" id="problem-statement-7">Problem Statement</a></h1>
<p id="rfc.section.9.1.p.1">The current Internet protocol stack has very limited facilities for network measurement and diagnostics. The only explicit measurement feature built into the stack is ICMP Echo (&#8220;ping&#8221;). In the meantime, the Internet measurement community has defined many inference- and assumption-based approaches for getting better information out of the network: traceroute and BGP looking glasses for topology information, TCP sequence number and TCP timestamp based approaches for latency and loss estimation, and so on. Each of these uses values placed on the wire for the internal use of the protocol, not for measurement purposes, and do not necessarily apply to the deployment of new protocols or changes to the use of those values by protocol implementations.  Approaches involving the encryption of transport protocol and application headers (indeed, including that the authors advance in <a href="#I-D.trammell-spud-req">[I-D.trammell-spud-req]</a>) will break most of these, as well.</p>
<p id="rfc.section.9.1.p.2">Replacing the information used for measurement with values defined explicitly to be used for measurement in a transport protocol independent way allows explicit endpoint control of measurability and measurement overhead.</p>
<p id="rfc.section.9.1.p.3">We note that current work in IPPM <a href="#I-D.ietf-ippm-6man-pdm-option">[I-D.ietf-ippm-6man-pdm-option]</a> proposes a roughly equivalent, IPv6-only, kernel-implementation-only facility.</p>
<h1 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2.</a> <a href="#information-exposed-7" id="information-exposed-7">Information Exposed</a></h1>
<p id="rfc.section.9.2.p.1">The &#8220;big five&#8221; metrics &#8211; latency, loss, jitter, data rate / goodput, and reordering &#8211; can be measured using a relatively simple set of primitives.  Packet receipt acknowledgment using a cumulative nonce echo allows both endpoint and on-path measurement of loss and reordering as well as goodput (when combined with layer 3 packet length headers). A timestamp echo facility, analogous to TCP&#8217;s timestamp option but using an explicitly defined, constant-rate clock and exposure of local delta (time between receipt and subsequent transmission).</p>
<p id="rfc.section.9.2.p.2">The cumulative nonce echo consists of two values: a number identifying a given packet (nonce), which also identifies all retransmissions of the packet, and a number which is the sum of all packet identifiers received from the remote endpoint (echo), modulo the maximum value of the echo field. Nonces need not be sequential, or even monotonic, but two packets with the same nonce should not be simultaneously in flight. These are exposed on a per-packet basis, but need not appear on every packet in the tube or flow, with the caveat that lower sampling rates lead to lower sensitivity.</p>
<p id="rfc.section.9.2.p.3">The timestamp echo consists of three values: The time in terms of ticks of a constant rate clock that a packet is sent, the echo of the last such timestamp received from the remote endpoint, and the number of ticks of the sender&#8217;s clock between the receipt of the last timestamp from the remote endpoint and the transmission of the packet containing the echo. This last delta value is the missing link in TCP sequence number based and timestamp option based latency estimation.</p>
<p id="rfc.section.9.2.p.4">The information exposed is roughly equivalent than that currently exposed by TCP as a side effect of its operation, but defined such that they are explicitly useful for measurement, useful regardless of transport protocol, and such that information exposure is in the explicit control of the endpoint (when the superstrate transport protocol&#8217;s headers are encrypted).</p>
<h1 id="rfc.section.9.3"><a href="#rfc.section.9.3">9.3.</a> <a href="#mechanism-7" id="mechanism-7">Mechanism</a></h1>
<p id="rfc.section.9.3.p.1">The nonce and timestamp echo information, emitted as per-packet signals in the SPUD header, can be used by any device which can see it to estimate performance metrics on a per-tube basis. This includes both remote endpoints, as well as passive performance measurement devices colocated with network gateways.</p>
<h1 id="rfc.section.9.4"><a href="#rfc.section.9.4">9.4.</a> <a href="#deployment-incentives-6" id="deployment-incentives-6">Deployment Incentives</a></h1>
<p id="rfc.section.9.4.p.1">Initial deployment of this facility is most likely in closed networks such as enterprise data centers, where a single administrative entity owns the network and the endpoints, can control which flows and tubes are annotated with measurement information, and can benefit from the additional insight given during network troubleshooting by explicit measurement headers.</p>
<p id="rfc.section.9.4.p.2">Further, since the provided measurement information is exposed by SPUD to the far-endpoint, it can be used for performance enhancement on these layers.  Once the facility is deployed in SPUD-aware endpoints, it can also be used for inter-network and cross-Internet performance measurement and debugging (replacing today&#8217;s processing-intensive DPI mechanisms).</p>
<h1 id="rfc.section.9.5"><a href="#rfc.section.9.5">9.5.</a> <a href="#security-privacy-and-trust-7" id="security-privacy-and-trust-7">Security, Privacy, and Trust</a></h1>
<p id="rfc.section.9.5.p.1">The cumulative nonce and timestamp echo leaks no more information about the traffic than the TCP header does. Indeed, since the cumulative nonce does not include sequence number information or other protocol-internal information, it allows passive measurement of loss and latency without giving measurement devices access to information they could use to spoof valid packets within a transport layer connection.</p>
<p id="rfc.section.9.5.p.2">In order to prevent middleboxes from modifying measurement-relevant information, these per-packet signals will need to be integrity protected by SPUD.</p>
<p id="rfc.section.9.5.p.3">Performance measurement boxes at gateways which observe and aggregate these signals will necessarily need to trust their accuracy, but can verify their plausibility by calculating nonce sums and synchronizing timing clocks.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.10.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.11.p.1">Security and privacy considerations for each use case are given in the corresponding Security, Privacy, and Trust subsection.</p>
<h1 id="rfc.section.12"><a href="#rfc.section.12">12.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.12.p.1">This document grew in part out of discussions of initial use cases for middlebox cooperation at the IAB SEMI Workshop and the IETF 92 SPUD BoF; thanks to the participants. Some use case details came out of discussions with the authors of the <a href="#I-D.trammell-spud-req">[I-D.trammell-spud-req]</a>: in addition to the editors of this document, David Black, Ken Calvert, Ted Hardie, Joe Hildebrand, Jana Iyengar, and Eric Rescorla. <a href="#meas">Section 9</a> is based in part on discussions and ongoing work with Mark Allman and Rob Beverly.</p>
<p id="rfc.section.12.p.2">This work is supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references"><a href="#rfc.references">13.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.hildebrand-spud-prototype">[I-D.hildebrand-spud-prototype]</b>
      </td>
      <td class="top"><a>Hildebrand, J.</a> and <a>B. Trammell</a>, "<a href="http://tools.ietf.org/html/draft-hildebrand-spud-prototype-03">Substrate Protocol for User Datagrams (SPUD) Prototype</a>", Internet-Draft draft-hildebrand-spud-prototype-03, March 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-ippm-6man-pdm-option">[I-D.ietf-ippm-6man-pdm-option]</b>
      </td>
      <td class="top"><a>Elkins, N.</a> and <a>M. Ackermann</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ippm-6man-pdm-option-01">IPv6 Performance and Diagnostic Metrics (PDM) Destination Option</a>", Internet-Draft draft-ietf-ippm-6man-pdm-option-01, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.trammell-spud-req">[I-D.trammell-spud-req]</b>
      </td>
      <td class="top"><a>Trammell, B.</a> and <a>M. K&#252;hlewind</a>, "<a href="http://tools.ietf.org/html/draft-trammell-spud-req-02">Requirements for the design of a Substrate Protocol for User Datagrams (SPUD)</a>", Internet-Draft draft-trammell-spud-req-02, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.you-tsvwg-latency-loss-tradeoff">[I-D.you-tsvwg-latency-loss-tradeoff]</b>
      </td>
      <td class="top"><a>You, J.</a>, <a>Welzl, M.</a>, <a>Trammell, B.</a>, <a>K&#252;hlewind, M.</a> and <a>K. Smith</a>, "<a href="http://tools.ietf.org/html/draft-you-tsvwg-latency-loss-tradeoff-00">Latency Loss Tradeoff PHB Group</a>", Internet-Draft draft-you-tsvwg-latency-loss-tradeoff-00, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1191">[RFC1191]</b>
      </td>
      <td class="top"><a>Mogul, J.</a> and <a>S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc1191">Path MTU discovery</a>", RFC 1191, DOI 10.17487/RFC1191, November 1990.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1981">[RFC1981]</b>
      </td>
      <td class="top"><a>McCann, J.</a>, <a>Deering, S.</a> and <a>J. Mogul</a>, "<a href="http://tools.ietf.org/html/rfc1981">Path MTU Discovery for IP version 6</a>", RFC 1981, DOI 10.17487/RFC1981, August 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4821">[RFC4821]</b>
      </td>
      <td class="top"><a>Mathis, M.</a> and <a>J. Heffner</a>, "<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>", RFC 4821, DOI 10.17487/RFC4821, March 2007.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div>

</body>
</html>
